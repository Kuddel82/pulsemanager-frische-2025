<!DOCTYPE html>
<html>
<head>
    <title>🚀 Tangem Wallet Test</title>
    <style>
        body { font-family: monospace; background: #1a1a1a; color: #00ff00; padding: 20px; }
        .result { margin: 10px 0; padding: 10px; background: #333; border-radius: 5px; }
        .success { border-left: 4px solid #00ff00; }
        .error { border-left: 4px solid #ff0000; }
        .info { border-left: 4px solid #00aaff; }
        button { background: #0066cc; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0088ee; }
    </style>
</head>
<body>
    <h1>🚀 Tangem Wallet DeFi Test</h1>
    <p><strong>Wallet:</strong> 0x3f020b5bcfdfa9b5970b1b22bba6da6387d0ea7a</p>
    <p><strong>Chain:</strong> Ethereum (1)</p>
    
    <button onclick="testTangemWallet()">🧪 Test Moralis APIs</button>
    
    <div id="results"></div>

    <script>
        const TANGEM_ADDRESS = '0x3f020b5bcfdfa9b5970b1b22bba6da6387d0ea7a';
        
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
            console.log(message);
        }
        
        async function testTangemWallet() {
            document.getElementById('results').innerHTML = '';
            log('🔥 Starting Tangem Wallet Tests...', 'info');
            log('📊 Address: ' + TANGEM_ADDRESS, 'info');
            log('⏰ Time: ' + new Date().toLocaleString(), 'info');
            
            const tests = [
                {
                    name: 'Portfolio Net Worth',
                    endpoint: 'portfolio'
                },
                {
                    name: 'DeFi Summary',
                    endpoint: 'defi-summary'
                },
                {
                    name: 'DeFi Positions',
                    endpoint: 'defi-positions'
                }
            ];
            
            for (const test of tests) {
                log(`🧪 Testing: ${test.name}`, 'info');
                
                try {
                    const url = `/api/moralis-v2?endpoint=${test.endpoint}&address=${TANGEM_ADDRESS}&chain=1`;
                    const response = await fetch(url);
                    const data = await response.json();
                    
                    if (data._error) {
                        log(`❌ ${test.name}: ${data._error.message}`, 'error');
                        
                        if (data._error.message.includes('PulseChain')) {
                            log('ℹ️ Tipp: DeFi APIs funktionieren nur mit Ethereum, nicht PulseChain', 'info');
                        }
                    } else {
                        log(`✅ ${test.name}: SUCCESS`, 'success');
                        
                        if (test.endpoint === 'portfolio') {
                            const value = data.result?.total_networth_usd || '0';
                            log(`   💰 Portfolio Value: $${value}`, 'success');
                        } else if (test.endpoint === 'defi-summary') {
                            const protocols = data.result?.active_protocols || '0';
                            const value = data.result?.total_usd_value || '0';
                            const unclaimed = data.result?.total_unclaimed_usd_value || '0';
                            log(`   🎯 Active Protocols: ${protocols}`, 'success');
                            log(`   💎 DeFi Value: $${value}`, 'success');
                            log(`   🎁 Unclaimed Rewards: $${unclaimed}`, 'success');
                            
                            if (parseFloat(unclaimed) > 0) {
                                log(`   🔥 ROI FOUND! $${unclaimed} in unclaimed rewards!`, 'success');
                            }
                        } else if (test.endpoint === 'defi-positions') {
                            const positions = Array.isArray(data.result) ? data.result : [];
                            log(`   📊 DeFi Positions: ${positions.length}`, 'success');
                            
                            positions.slice(0, 5).forEach((pos, i) => {
                                const protocol = pos.protocol_name || 'Unknown';
                                const balance = parseFloat(pos.balance_usd || 0).toFixed(2);
                                const unclaimed = parseFloat(pos.total_unclaimed_usd_value || 0).toFixed(2);
                                log(`     ${i+1}. ${protocol}: $${balance} ${unclaimed > 0 ? '(+$' + unclaimed + ' unclaimed)' : ''}`, 'success');
                            });
                        }
                    }
                } catch (error) {
                    log(`💥 ${test.name}: FETCH ERROR - ${error.message}`, 'error');
                }
            }
            
            log('🏁 Test completed!', 'info');
            log('💡 If you see DeFi data here but not in ROI Tracker, the wallet needs to be added as Ethereum wallet!', 'info');
        }
    </script>
</body>
</html> 